# =========================
# Gateway server
# =========================
spring.application.name=gateway-service
server.port=8081
server.address=0.0.0.0

# (optionnel mais utile derrière un proxy/tunnel)
server.forward-headers-strategy=framework

# =========================
# Config Server / Vault (si utilisés)
# =========================
spring.config.import=optional:configserver:http://localhost:9999,optional:vault:
spring.cloud.vault.authentication=TOKEN
spring.cloud.vault.token=root
spring.cloud.vault.scheme=http
spring.cloud.vault.host=localhost
spring.cloud.vault.port=8200

# =========================
# Eureka
# =========================
spring.cloud.discovery.enabled=true
eureka.client.service-url.defaultZone=http://localhost:8761/eureka
eureka.instance.prefer-ip-address=true

# =========================
# Discovery locator (NOUVELLES CLÉS WebFlux)
# =========================
spring.cloud.gateway.server.webflux.discovery.locator.enabled=true
spring.cloud.gateway.server.webflux.discovery.locator.lower-case-service-id=true

# =========================
# Routes (NOUVELLES CLÉS WebFlux)
# =========================
spring.cloud.gateway.server.webflux.routes[0].id=auth-route
spring.cloud.gateway.server.webflux.routes[0].uri=lb://authentification-service
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/auth/**

# Si tu AJOUTES d'autres routes, incrémente l'index [1], [2], etc.

# =========================
# CORS global (NOUVELLES CLÉS WebFlux)
# En dev tu peux laisser * ; sinon mets exactement l'origine tunnel.
# =========================
# Autoriser uniquement ton tunnel Cloudflare (plus sûr) :
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowed-origins=http://copyrights-dakota-extensions-requiring.trycloudflare.com
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowed-headers=Authorization,Content-Type
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].exposed-headers=Authorization
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allow-credentials=true

# (Alternative DEV permissive):
# spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowed-origins=*
# spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowed-methods=*
# spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowed-headers=*

# =========================
# Resource Server (JWT)
# (pointe vers TON Keycloak en HTTPS via Cloudflare)
# =========================
spring.security.oauth2.resourceserver.jwt.issuer-uri=http://copyrights-dakota-extensions-requiring.trycloudflare.com/realms/babyGuardian-realm